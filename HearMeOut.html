<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Polish Mobile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Hide scrollbar for clean look */
        textarea::-webkit-scrollbar { display: none; }
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        
        /* Pulse animation for recording state */
        .pulse-ring {
            box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            animation: pulse-red 1.5s infinite cubic-bezier(0.66, 0, 0, 1);
        }
        
        @keyframes pulse-red {
            to {
                box-shadow: 0 0 0 20px rgba(239, 68, 68, 0);
            }
        }
        
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-4">

    <!-- Header -->
    <div class="w-full max-w-md bg-white rounded-xl shadow-lg p-6 mb-4">
        <h1 class="text-2xl font-bold text-gray-800 text-center mb-2">Voice Polish</h1>
        <p class="text-sm text-gray-500 text-center">Tap the mic button or type text, then click refine.</p>
    </div>

    <!-- Input Area with Mic Button -->
    <div class="w-full max-w-md bg-white rounded-xl shadow-lg p-4 mb-4 flex-grow flex flex-col relative">
        <textarea id="inputText" 
            class="w-full flex-grow p-4 text-lg border-none focus:ring-0 resize-none text-gray-700 placeholder-gray-400 mb-12"
            placeholder="Tap the mic to start dictating..."
            style="min-height: 200px; outline: none;"></textarea>
            
        <!-- Floating Mic Button -->
        <button id="micBtn" onclick="toggleDictation()" 
            class="absolute bottom-4 right-4 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-full p-4 transition-all duration-300 shadow-sm border border-gray-200 flex items-center justify-center group">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 group-hover:scale-110 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
            </svg>
        </button>
    </div>

    <!-- Controls -->
    <div class="w-full max-w-md space-y-3">
        
        <!-- Settings -->
        <div class="flex space-x-2">
            <select id="tone" class="w-1/2 p-3 bg-white rounded-lg shadow text-gray-700 font-medium border-r-8 border-transparent px-4 outline-none">
                <option value="Professional">Professional</option>
                <option value="Casual">Casual</option>
                <option value="Witty">Witty</option>
                <option value="Empathetic">Empathetic</option>
            </select>
            <select id="style" class="w-1/2 p-3 bg-white rounded-lg shadow text-gray-700 font-medium border-r-8 border-transparent px-4 outline-none">
                <option value="Concise Paragraph">Concise</option>
                <option value="Normal Length">Normal</option>
                <option value="Bullet Points">Bullets</option>
            </select>
        </div>

        <!-- Action Button -->
        <button id="refineBtn" onclick="processText()" 
            class="w-full bg-blue-600 active:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg transition transform active:scale-95 flex justify-center items-center text-lg">
            <span>âœ¨ Polish Text</span>
        </button>

        <!-- Copy Button (Hidden initially) -->
        <button id="copyBtn" onclick="copyText()" 
            class="hidden w-full bg-green-500 active:bg-green-600 text-white font-bold py-4 rounded-xl shadow-lg transition transform active:scale-95 text-lg">
            ðŸ“‹ Copy to Clipboard
        </button>

        <!-- Status Message -->
        <div id="status" class="text-center text-gray-500 text-sm h-6 mt-2"></div>
    </div>

    <script>
        const API_KEY = 'AIzaSyBDReCXQ4cbWYyMh_Foz9rpuXad5UyA9pQ';
        let recognition = null;
        let isRecording = false;

        // Initialize Speech Recognition
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            recognition.onresult = (event) => {
                let interimTranscript = '';
                let finalTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        finalTranscript += event.results[i][0].transcript;
                    } else {
                        interimTranscript += event.results[i][0].transcript;
                    }
                }

                const textArea = document.getElementById('inputText');
                // Append text only if it's new (simple logic for demo)
                // For continuous dictation, we often just add the new part
                if (finalTranscript) {
                    textArea.value += (textArea.value.length > 0 ? ' ' : '') + finalTranscript;
                    // Auto-scroll to bottom
                    textArea.scrollTop = textArea.scrollHeight;
                }
            };

            recognition.onerror = (event) => {
                console.error("Speech error", event);
                stopDictation(); // Stop UI if error occurs
                document.getElementById('status').textContent = "Microphone error or permission denied.";
            };
        } else {
            document.getElementById('micBtn').style.display = 'none';
            document.getElementById('status').textContent = "Browser does not support direct dictation.";
        }

        function toggleDictation() {
            if (!recognition) return;

            if (isRecording) {
                stopDictation();
            } else {
                startDictation();
            }
        }

        function startDictation() {
            try {
                recognition.start();
                isRecording = true;
                
                // UI Updates for Recording State
                const btn = document.getElementById('micBtn');
                btn.classList.remove('bg-gray-100', 'text-gray-600');
                btn.classList.add('bg-red-500', 'text-white', 'pulse-ring');
                document.getElementById('status').textContent = "Listening...";
            } catch (e) {
                console.error(e);
            }
        }

        function stopDictation() {
            try {
                recognition.stop();
                isRecording = false;
                
                // UI Updates for Stopped State
                const btn = document.getElementById('micBtn');
                btn.classList.add('bg-gray-100', 'text-gray-600');
                btn.classList.remove('bg-red-500', 'text-white', 'pulse-ring');
                document.getElementById('status').textContent = "";
            } catch (e) {
                console.error(e);
            }
        }

        async function processText() {
            // Stop recording if active when user clicks polish
            if (isRecording) stopDictation();

            const textArea = document.getElementById('inputText');
            const text = textArea.value.trim();
            const tone = document.getElementById('tone').value;
            const style = document.getElementById('style').value;
            const btn = document.getElementById('refineBtn');
            const status = document.getElementById('status');

            if (!text) {
                status.textContent = "Please enter or speak some text first.";
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<div class="loader mr-2"></div> Polishing...';
            status.textContent = "Sending to Gemini AI...";

            const promptString = `Refine the following text to be ${tone} in tone and formatted as ${style}. Fix grammar and remove filler words. Only return the refined text, nothing else: "${text}"`;

            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: promptString }] }]
                        })
                    }
                );

                const result = await response.json();
                const refinedText = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (refinedText) {
                    textArea.value = refinedText;
                    status.textContent = "Done!";
                    document.getElementById('copyBtn').classList.remove('hidden');
                    document.getElementById('refineBtn').classList.add('hidden');
                } else {
                    status.textContent = "Error: Could not refine text.";
                    console.error(result);
                }

            } catch (error) {
                status.textContent = "Network Error. Check console.";
                console.error(error);
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'âœ¨ Polish Text';
            }
        }

        function copyText() {
            const textArea = document.getElementById('inputText');
            textArea.select();
            textArea.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(textArea.value).then(() => {
                const copyBtn = document.getElementById('copyBtn');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = "Copied! âœ…";
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.classList.add('hidden');
                    document.getElementById('refineBtn').classList.remove('hidden');
                    textArea.value = "";
                    textArea.placeholder = "Ready for next input...";
                }, 1500);
            });
        }
    </script>
</body>
</html>